<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.paint.Color?>
<?import javafx.collections.FXCollections?>

<BorderPane stylesheets="@/styles/schedule.css" xmlns="http://javafx.com/javafx/23.0.1" 
            xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="controllers.Staff.MyScheduleController"
            prefHeight="700" prefWidth="1000">

   <!-- Header - Chiếm khoảng 15% chiều cao -->
   <top>
      <VBox spacing="5" style="-fx-background-color: #f5f5f5;" prefHeight="100">
         <padding>
            <Insets bottom="10" left="15" right="15" top="15"/>
         </padding>
         
         <HBox alignment="CENTER_LEFT" spacing="15">
            <Label fx:id="dateLabel" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #d88e3f;" 
                   text="LỊCH LÀM VIỆC CÁ NHÂN"/>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <HBox spacing="10" alignment="CENTER_RIGHT">
               <Label style="-fx-font-weight: bold;" text="Nhân viên:"/>
               <Label fx:id="staffNameLabel" text="Nguyễn Văn A" style="-fx-min-width: 120;"/>
               
               <Separator orientation="VERTICAL"/>
               
               <Label style="-fx-font-weight: bold;" text="Vị trí:"/>
               <Label fx:id="positionLabel" text="Nhân viên chăm sóc" style="-fx-min-width: 150;"/>
            </HBox>
         </HBox>
         
         <Separator style="-fx-padding: 5 0 0 0;"/>
      </VBox>
   </top>
   
   <!-- Main Content - Chiếm khoảng 70% chiều cao -->
   <center>
      <TabPane tabClosingPolicy="UNAVAILABLE" style="-fx-font-size: 14px;" BorderPane.alignment="CENTER">
         <tabs>
            <!-- Tab 1: Lịch làm việc -->
            <Tab text="Lịch làm việc">
               <content>
                  <BorderPane>
                     <!-- Filter Section - Chiếm khoảng 10% chiều cao tab -->
                     <top>
                        <VBox spacing="10" style="-fx-background-color: #f9f9f9; -fx-padding: 15;" prefHeight="80">
                           <HBox alignment="CENTER_LEFT" spacing="15">
                              <Label style="-fx-font-weight: bold; -fx-min-width: 80;" text="Chọn ngày:"/>
                              <DatePicker fx:id="datePicker" prefWidth="150"/>
                              
                              <Label style="-fx-font-weight: bold; -fx-min-width: 80;" text="Chế độ xem:"/>
                              <ComboBox fx:id="viewModeSelector" prefWidth="150" promptText="Chọn chế độ xem">
                              </ComboBox>
                              
                              <Region HBox.hgrow="ALWAYS"/>
                              
                              <Label style="-fx-font-weight: bold; -fx-min-width: 80;" text="Lọc theo ca:"/>
                              <ComboBox fx:id="shiftFilter" prefWidth="150" promptText="Tất cả ca"/>
                              <Button onAction="#applyFilter" style="-fx-background-color: #d88e3f; -fx-text-fill: white; -fx-min-width: 80;" text="Áp dụng"/>
                           </HBox>
                        </VBox>
                     </top>
                     
                     <!-- Schedule View - Chiếm khoảng 70% chiều cao tab -->
                     <center>
                        <ScrollPane fitToWidth="true" style="-fx-background: white;" BorderPane.alignment="CENTER">
                           <StackPane>
                              <!-- Day View -->
                              <VBox fx:id="dayView">
                                 <TableView fx:id="scheduleTable" style="-fx-font-size: 13px;" VBox.vgrow="ALWAYS">
                                    <columns>
                                       <TableColumn fx:id="idColumn" prefWidth="70" text="Mã lịch" style="-fx-alignment: CENTER;"/>
                                       <TableColumn fx:id="dateColumn" prefWidth="100" text="Ngày" style="-fx-alignment: CENTER;"/>
                                       <TableColumn fx:id="shiftColumn" prefWidth="120" text="Ca làm việc" style="-fx-alignment: CENTER;"/>
                                       <TableColumn fx:id="startTimeColumn" prefWidth="100" text="Bắt đầu" style="-fx-alignment: CENTER;"/>
                                       <TableColumn fx:id="endTimeColumn" prefWidth="100" text="Kết thúc" style="-fx-alignment: CENTER;"/>
                                       <TableColumn fx:id="locationColumn" prefWidth="150" text="Địa điểm" style="-fx-alignment: CENTER_LEFT;"/>
                                       <TableColumn fx:id="taskColumn" prefWidth="200" text="Công việc" style="-fx-alignment: CENTER_LEFT;"/>
                                       <TableColumn fx:id="noteColumn" prefWidth="250" text="Ghi chú" style="-fx-alignment: CENTER_LEFT;"/>
                                    </columns>
                                 </TableView>
                              </VBox>
                              
                              <!-- Week View (hidden by default) -->
                              <VBox fx:id="weekView" managed="false" visible="false">
                                 <GridPane alignment="CENTER" hgap="1" style="-fx-background-color: #e0e0e0;" vgap="1">
                                    <!-- Header row with days of week -->
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Thứ 2" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Thứ 3" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Thứ 4" GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Thứ 5" GridPane.columnIndex="3" GridPane.rowIndex="0"/>
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Thứ 6" GridPane.columnIndex="4" GridPane.rowIndex="0"/>
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Thứ 7" GridPane.columnIndex="5" GridPane.rowIndex="0"/>
                                    <Label style="-fx-font-weight: bold; -fx-padding: 10; -fx-background-color: #f5f5f5; -fx-min-width: 100;" text="Chủ Nhật" GridPane.columnIndex="6" GridPane.rowIndex="0"/>
                                    
                                    <!-- Shift rows -->
                                    <Label style="-fx-font-weight: bold; -fx-padding: 5 10; -fx-background-color: #d0e8f2;" text="Ca sáng" GridPane.columnIndex="0" GridPane.columnSpan="7" GridPane.rowIndex="1"/>
                                    <VBox fx:id="monMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <VBox fx:id="tueMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                                    <VBox fx:id="wedMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="2" GridPane.rowIndex="2"/>
                                    <VBox fx:id="thuMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="3" GridPane.rowIndex="2"/>
                                    <VBox fx:id="friMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="4" GridPane.rowIndex="2"/>
                                    <VBox fx:id="satMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="5" GridPane.rowIndex="2"/>
                                    <VBox fx:id="sunMorning" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="6" GridPane.rowIndex="2"/>
                                    
                                    <Label style="-fx-font-weight: bold; -fx-padding: 5 10; -fx-background-color: #ffecc7;" text="Ca chiều" GridPane.columnIndex="0" GridPane.columnSpan="7" GridPane.rowIndex="3"/>
                                    <VBox fx:id="monAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                                    <VBox fx:id="tueAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="1" GridPane.rowIndex="4"/>
                                    <VBox fx:id="wedAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="2" GridPane.rowIndex="4"/>
                                    <VBox fx:id="thuAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="3" GridPane.rowIndex="4"/>
                                    <VBox fx:id="friAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="4" GridPane.rowIndex="4"/>
                                    <VBox fx:id="satAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="5" GridPane.rowIndex="4"/>
                                    <VBox fx:id="sunAfternoon" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="6" GridPane.rowIndex="4"/>
                                    
                                    <Label style="-fx-font-weight: bold; -fx-padding: 5 10; -fx-background-color: #e8d0f2;" text="Ca tối" GridPane.columnIndex="0" GridPane.columnSpan="7" GridPane.rowIndex="5"/>
                                    <VBox fx:id="monEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="0" GridPane.rowIndex="6"/>
                                    <VBox fx:id="tueEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                                    <VBox fx:id="wedEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="2" GridPane.rowIndex="6"/>
                                    <VBox fx:id="thuEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="3" GridPane.rowIndex="6"/>
                                    <VBox fx:id="friEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="4" GridPane.rowIndex="6"/>
                                    <VBox fx:id="satEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="5" GridPane.rowIndex="6"/>
                                    <VBox fx:id="sunEvening" style="-fx-background-color: white; -fx-min-height: 100;" GridPane.columnIndex="6" GridPane.rowIndex="6"/>
                                    
                                    <columnConstraints>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                       <ColumnConstraints hgrow="ALWAYS" minWidth="100"/>
                                    </columnConstraints>
                                    <rowConstraints>
                                       <RowConstraints minHeight="30"/>
                                       <RowConstraints minHeight="30"/>
                                       <RowConstraints minHeight="100"/>
                                       <RowConstraints minHeight="30"/>
                                       <RowConstraints minHeight="100"/>
                                       <RowConstraints minHeight="30"/>
                                       <RowConstraints minHeight="100"/>
                                    </rowConstraints>
                                 </GridPane>
                              </VBox>
                           </StackPane>
                        </ScrollPane>
                     </center>
                     
                     <!-- Summary Section - Chiếm khoảng 20% chiều cao tab -->
                     <bottom>
                        <VBox spacing="10" style="-fx-background-color: #f9f9f9; -fx-padding: 15;" prefHeight="120">
                           <GridPane hgap="15" vgap="10">
                              <columnConstraints>
                                 <ColumnConstraints halignment="RIGHT" prefWidth="150"/>
                                 <ColumnConstraints hgrow="ALWAYS"/>
                              </columnConstraints>
                              
                              <Label style="-fx-font-weight: bold;" text="Thông tin chi tiết:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                              <TextArea fx:id="additionalInfoArea" prefHeight="60" wrapText="true" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                              
                              <Label style="-fx-font-weight: bold;" text="Tổng ca làm việc:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                              <HBox alignment="CENTER_LEFT" spacing="15" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                 <Label fx:id="totalShiftsLabel" style="-fx-font-weight: bold; -fx-min-width: 30;" text="0"/>
                                 <Separator orientation="VERTICAL"/>
                                 <Label style="-fx-font-weight: bold; -fx-min-width: 60;" text="Ca sáng:"/>
                                 <Label fx:id="morningShiftsLabel" style="-fx-min-width: 30;" text="0"/>
                                 <Separator orientation="VERTICAL"/>
                                 <Label style="-fx-font-weight: bold; -fx-min-width: 60;" text="Ca chiều:"/>
                                 <Label fx:id="afternoonShiftsLabel" style="-fx-min-width: 30;" text="0"/>
                                 <Separator orientation="VERTICAL"/>
                                 <Label style="-fx-font-weight: bold; -fx-min-width: 60;" text="Ca tối:"/>
                                 <Label fx:id="eveningShiftsLabel" style="-fx-min-width: 30;" text="0"/>
                              </HBox>
                           </GridPane>
                           
                           <HBox alignment="CENTER_RIGHT" spacing="10">
                              <Button fx:id="requestLeaveButton" onAction="#requestLeave" style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-min-width: 150;" text="Yêu cầu nghỉ phép"/>
                              <Button fx:id="requestShiftChangeButton" onAction="#requestShiftChange" style="-fx-background-color: #FFC107; -fx-text-fill: white; -fx-min-width: 100;" text="Đổi ca"/>
                              <Button onAction="#refreshSchedule" style="-fx-min-width: 100;" text="Làm mới"/>
                           </HBox>
                        </VBox>
                     </bottom>
                  </BorderPane>
               </content>
            </Tab>
            
            <!-- Tab 2: Đăng ký ca làm -->
            <Tab text="Đăng ký ca làm">
               <content>
                  <BorderPane>
                     <top>
                        <VBox spacing="10" style="-fx-background-color: #f5f5f5;" prefHeight="80">
                           <padding>
                              <Insets bottom="10" left="15" right="15" top="15"/>
                           </padding>
                           <Label style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #d88e3f;" text="ĐĂNG KÝ CA LÀM VIỆC"/>
                           <Separator/>
                        </VBox>
                     </top>
                     
                     <center>
                        <ScrollPane fitToWidth="true" BorderPane.alignment="CENTER">
                           <GridPane alignment="CENTER" hgap="15" vgap="15" style="-fx-padding: 30;">
                              <columnConstraints>
                                 <ColumnConstraints halignment="RIGHT" prefWidth="150"/>
                                 <ColumnConstraints prefWidth="300"/>
                              </columnConstraints>
                              
                              <Label text="Ngày làm việc:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                              <DatePicker fx:id="registrationDatePicker" prefWidth="200" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                              
                              <Label text="Ca làm việc:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                              <ComboBox fx:id="shiftSelector" prefWidth="200" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                              
                              <Label text="Vị trí làm việc:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                              <ComboBox fx:id="locationSelector" prefWidth="200" GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                              
                              <Label text="Ghi chú:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                              <TextArea fx:id="registrationNotes" prefHeight="100" prefWidth="200" wrapText="true" GridPane.columnIndex="1" GridPane.rowIndex="3"/>
                              
                              <HBox alignment="CENTER" spacing="15" GridPane.columnIndex="0" GridPane.columnSpan="2" GridPane.rowIndex="4" style="-fx-padding: 15 0 0 0;">
                                 <Button fx:id="registerShiftButton" onAction="#registerShift" style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-min-width: 150;" text="Đăng ký ca làm"/>
                                 <Button onAction="#cancelRegistration" style="-fx-min-width: 100;" text="Hủy"/>
                              </HBox>
                           </GridPane>
                        </ScrollPane>
                     </center>
                     
                     <bottom>
                        <VBox style="-fx-background-color: #f9f9f9; -fx-padding: 15;" prefHeight="80">
                           <Label style="-fx-font-style: italic; -fx-text-fill: #666;" text="Lưu ý: Đăng ký ca làm cần được quản lý xác nhận trước khi có hiệu lực."/>
                           <Label style="-fx-font-style: italic; -fx-text-fill: #666;" text="Hạn đăng ký: Trước 48 giờ so với ca làm việc."/>
                        </VBox>
                     </bottom>
                  </BorderPane>
               </content>
            </Tab>
         </tabs>
      </TabPane>
   </center>
   
   <!-- Footer - Chiếm khoảng 15% chiều cao -->
   <bottom>
      <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-background-color: #f0f0f0; -fx-padding: 10;" prefHeight="50">
         <Label fx:id="statusLabel" text="Trạng thái: Đã tải lịch làm việc"/>
         <Region HBox.hgrow="ALWAYS"/>
         <Button fx:id="homeButton" onAction="#goToHome" style="-fx-background-color: #d88e3f; -fx-text-fill: white; -fx-min-width: 120;" text="Về trang chủ"/>
         <Button onAction="#showHelp" style="-fx-min-width: 80;" text="Trợ giúp"/>
         <Button onAction="#exitApplication" style="-fx-min-width: 80;" text="Thoát"/>
      </HBox>
   </bottom>
</BorderPane>